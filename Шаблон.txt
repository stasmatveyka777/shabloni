<!doctype html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Invoice</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
    }

    body {
      font-size: 14px;
      line-height: 1.3;
      min-width: 320px;
      font-family: Tahoma, Arial, sans-serif;
      overflow-x: hidden;
    }

    .container {
      margin-right: auto;
      margin-left: auto;
      max-width: 900px;
    }

    .text-center {
      text-align: center;
    }

    .text-right {
      text-align: right;
    }
    
    .text-left {
      text-align: left;
    }

    .label {
      font-weight: bold;
    }
    
    .underline {
      text-decoration: underline;
      font-style: italic;
    }

    .big-text {
      font-size: 16px;
      font-weight: bold;
    }
    
    .width100 {
      width: 100%;
    }

    table {
      border-collapse: collapse;
      border-spacing: 0;
      height: auto;
    }

    table td {
      padding: 4px 6px;
      vertical-align: middle;
    }

    table th {
      background: #d4d4d4;
      font-weight: bold;
      padding: 6px 6px;
      vertical-align: middle;
    }

    /* --- СТИЛІ ТАБЛИЦІ ТОВАРІВ --- */
    table.table-products {
      width: 100%;
      border: 1px solid #000;
      font-size: 13px;
      table-layout: fixed; /* Фіксована ширина колонок */
    }

    table .table-products td,
    table .table-products th {
      border: 1px solid #000;
      word-wrap: break-word; 
      overflow-wrap: break-word;
    }

    table.table-products td {
      padding: 4px 6px;
    }
    
    /* Стилі для нижньої частини з підписами */
    table.table-sum {
      margin-top: 30px; /* Трохи більше відступу зверху */
      font-size: 13px;
    }
    
    table.table-sum td {
      padding: 3px 5px 3px 0;
      vertical-align: bottom;
    }
  </style>
</head>
<body>

<div class="container">

  <table class="width100">
    <tbody>
    <tr>
      <td class="logo-wrapper" valign="top">
        </td>
      <td valign="top">
        <span></span><br />
        <span></span><br />
      </td>
      <td valign="top">

      </td>
    </tr>
    </tbody>
  </table>
  
  <br /><br /><br />

  <table class="width100">
    <tbody>
    <tr>
      <td valign="top" class="label" style="width:50%">
        <span>Постачальник: </span><br />
        <span>ФОП Тапдигова Софія Миколаївна<br>
ЄДРПОУ: 3211816643<br>
Рахунок (IBAN): UA033003350000000260012433343<br>
Банк отримувача: АТ «Райффайзен Банк»</span><br />
        <span>м. Чернівці</span><br />
        <span></span><br />
      </td>
      <td valign="top" class="label">
        Одержувач: {{ model.recipient_full_name ? model.recipient_full_name : model.client_name }}<br />
      </td>
    </tr>
    </tbody>
  </table>
  <br />

  <p class="big-text text-center" style="margin-bottom: 10px">
    {% set mnths = ['','січня','лютого','березня','квітня','травня','червня','липня','серпня','вересня','жовтня','листопада','грудня'] %}
    Видаткова накладна №{{ model.id }} від {{ model.created_at|date("j") }} {{ mnths[model.created_at|date("n")] }} {{ model.created_at|date("Y") }} р.
  </p>

  <table class="width100 border table-products">
    <thead>
      <tr>
        <th class="name-col" style="width: 40%;">Назва товару</th>
        <th style="width: 15%;">Ціна клієнта</th>
        <th style="width: 15%;">Кількість</th>
        <th style="width: 15%;">Ціна косм.</th>
        <th style="width: 15%;">Сума</th>
      </tr>
    </thead>
      
    {% for key, product in model.products %}
      <tr class="table-products">
        <td class="text-left">{{ product.product_name }}</td>
        <td class="text-center">
          {{ product.product_price|format_currency('UAH', locale='uk') }}
        </td>
        <td class="text-center">
          {{ product.product_quantity }}
        </td>
        <td class="text-center">
          {{ product.price_sold|format_currency('UAH', locale='uk') }}
        </td>
        <td class="text-right">
          {{ (product.product_quantity * product.price_sold)|format_currency('UAH', locale='uk') }}
        </td>
      </tr>
    {% endfor %}
  </table>
    
  {% set products_discount = 0 %}
  {% for key, product in model.products %}
      {% set products_discount = products_discount + ((product.product_discount  != '-' ? product.product_discount : 0) * product.product_quantity) %}
  {% endfor %}
    
  <table class="width100">
      {% if products_discount > 0 or model.discount_amount or model.shipping_price  %}
      <tr>
        <td colspan="6" class="text-right">Всього за товари:</td>
        <td class="text-right" style="width: 15%;">{{ (model.total_price + products_discount)|format_currency('UAH', locale='uk') }}</td>
      </tr>
      {% endif %}

      {% if products_discount > 0 or model.discount_amount %}
      <tr>
        <td colspan="6" class="text-right">Знижка:</td>
        <td class="text-right">{{ (products_discount + model.discount_amount)|format_currency('UAH', locale='uk') }}</td>
      </tr>
      {% endif %}
      
      {% if model.shipping_price %}
      <tr>
        <td colspan="6" class="text-right">Доставка:</td>
        <td class="text-right">{{ model.shipping_price|format_currency('UAH', locale='uk') }}</td>
      </tr>
      {% endif %}

      <tr>
        <td colspan="6" class="text-right" style="font-weight: bold;">Сума до оплати:</td>
        <td class="text-right" style="font-weight: bold;">{{ model.grand_total|format_currency('UAH', locale='uk') }}</td>
      </tr>
      
      <tr>
        <td colspan="7" class="text-right" style="padding-top: 5px;">
           Всього найменувань {{ model.products|length }}, на суму {{ model.grand_total|format_currency('UAH', locale='uk') }}
        </td>
      </tr>

  </table>
  
  <br />
  
  <table class="table-sum width100">
    <tr>
      <td style="width: 50%;">
        Постачальник (ФОП Тапдигова С. М.):<br>
        <br>
        ________________________
      </td>
      
      <td style="width: 50%;">
        Одержувач:<br>
        <span style="font-weight: bold;">
            {{ model.recipient_full_name ? model.recipient_full_name : model.client_name }}
        </span><br>
        ________________________
      </td>
    </tr>
  </table>
</div>

</body>
</html>
